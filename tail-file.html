<script type="text/x-red" data-template-name="tail-file">
    <div class="form-row">
        <label for="node-input-filename"><i class="fa fa-file"></i> Filename</label>
        <input type="text" id="node-input-filename">
    </div>

    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-createFile" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-createFile" style="width: 70%;"><span>Create File if not exists</span></label>
    </div>

    <div class="form-row">
        <label for="node-input-encoding"><i class="fa fa-font"></i> Encoding</label>
        <select id="node-input-encoding" style="width: 150px;">
            <option value="utf-8">utf8&nbsp;/&nbsp;utf-8</option>
            <option value="ucs2">ucs2&nbsp;/&nbsp;ucs-2</option>
            <option value="utf16le">utf16le&nbsp;/&nbsp;utf-16le</option>
            <option value="latin1">latin1</option>
            <option value="binary">binary</option>
            <option value="base64">base64</option>
            <option value="ascii">ascii</option>
            <option value="hex">hex</option>
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-mode"><i class="fa fa-random"></i> Mode</label>
        <select id="node-input-mode" style="width: 150px;">
            <option value="">Normal</option>
            <option value="replaced">Rewritable&nbsp;file</option>
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-separator"><i class="fa fa-code"></i> Split</label>
        <input type="checkbox" id="node-input-split" style="display: inline-block; width: auto; margin: auto;">
        <label for="node-input-split" style="width: auto;"><span style="vertical-align: middle;">Use separator:&nbsp;</span></label>
        <input type="text" id="node-input-separator" placeholder="[\r]{0,1}\n" style="width: 160px;">
    </div>

    <div class="form-row">
        <label><i class="fa fa-bars"></i><span> Optional</span></label>
        <input type="checkbox" id="node-input-fromBeginning" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-fromBeginning" style="width: 70%;"><span>From beginning</span></label>
    </div>

    <div class="form-row" id="node-tail-file-flush">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-flushAtEOF" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-flushAtEOF" style="width: 70%;"><span>Flush at EOF</span></label>
    </div>

    <div class="form-row" id="node-tail-file-remember">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-rememberLast" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-rememberLast" style="width: 70%;"><span>Try to remember the last entry</span></label>
    </div>

    <div class="form-row" id="node-tail-file-maxBytes">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-bytes" style="display: inline-block; width: auto; margin: auto;">
        <label for="node-input-bytes" style="width: auto;"><span style="vertical-align: middle;">Maximum in one read:&nbsp;</span></label>
        <input type="number" min="1" id="node-input-maxBytes" placeholder="5120" style="width: 70px; height: 28px;">
        <label for="node-input-bytes" style="width: auto;"><span style="vertical-align: middle;">&nbsp;bytes</span></label>
    </div>

    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-skipBlank" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-skipBlank" style="width: 70%;"><span>Skip blank entries</span></label>
    </div>

    <div class="form-row" id="node-tail-file-trim" style="display: block;">
        <label>&nbsp;</label>
        <label style="width: 15px;" label=""></label>
        <input type="checkbox" id="node-input-useTrim" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-useTrim" style="width: 65%;"><span>Use .trim() to check for blank entries</span></label>
    </div>

    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-errors" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-errors" style="width: 70%;"><span>Allow error messages</span></label>
    </div>

    <div class="form-row">
        <label for="node-input-interval"><i class="fa fa-refresh"></i> Interval</label>
        <input type="number" min="1" id="node-input-interval" placeholder="100" style="width: 70px;">
        &nbsp;<span>milliseconds</span>
    </div>


    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>


    <div class="form-row" id="node-tail-file-debug">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-echo" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-echo" style="width: 70%;"><span>echo</span></label>
    </div>
</script>

<script type="text/x-red" data-help-name="tail-file">
    <p>Tails (watches for things to be added) to the configured file. (currently Windows ONLY)</p>
    <p>Based on original Tail and <a href="https://github.com/lucagrulla/node-tail" target="_blank">lucagrulla/node-tail</a></p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('tail-file', {
        category: 'storage-input',
        defaults: {
            echo: { value: true },
            filename: { value: "e:/www.txt" },    // e:/www.txt
            createFile: { value: false },
            encoding: { value: "utf-8" },
            mode: { value: "" },
            split: { value: true },
            separator: { value: "" },
            fromBeginning: { value: false },
            flushAtEOF: { value: false },
            rememberLast: { value: true },
            bytes: { value: true },
            maxBytes: { value: "" },
            skipBlank: { value: true },
            useTrim: { value: true },
            errors: { value: true },
            interval: { value: "" },
            name: { value: "" }
        },
        color: "burlywood",
        inputs: 1,
        outputs: 1,
        icon: "file.png",
        label: function () {
            return this.name || this.filename || "tail file";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function () {
            $("#node-input-split").change(function () {
                $("#node-input-separator").attr('disabled', !$("#node-input-split").prop('checked'));
            })
            $("#node-input-mode").on("change", function () {
                if (this.value === "") {
                    $("#node-tail-file-flush").show();
                    $("#node-tail-file-remember").hide();
                } else {
                    $("#node-tail-file-flush").hide();
                    $("#node-tail-file-remember").show();
                }
            });
            $("#node-input-bytes").change(function () {
                $("#node-input-maxBytes").attr('disabled', !$("#node-input-bytes").prop('checked'));
            })
            $("#node-input-skipBlank").on("change", function () {
                if (this.checked === true) {
                    $("#node-tail-file-trim").show();
                } else {
                    $("#node-tail-file-trim").hide();
                }
            });
        }
    });
</script>
